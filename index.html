<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Raccoon Coin</title>
    <style>
        /* –°—Ç–∏–ª—ñ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç—ñ–ª–∞ —Ç–∞ —à—Ä–∏—Ñ—Ç—ñ–≤ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        :root {
            --yellow: #fde047;
            --dark-gray: #1f2937;
            --light-gray: #4b5563;
            --text-color: #ffffff;
            --critical-color: #ef4444;
            --notification-bg: rgba(239, 68, 68, 0.8);
            --bonus-notification-bg: rgba(52, 211, 153, 0.8);
            --progress-bar-bg: #4b5563;
            --progress-bar-fill: #fde047;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(180deg, #4a3f00 0%, #1c1910 100%);
            color: var(--text-color);
            display: flex;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫ */
        .page-container {
            width: 100%;
            height: 100%;
            position: relative;
            padding-left: 80px; /* –í—ñ–¥—Å—Ç—É–ø –¥–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ—ó –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó */
            box-sizing: border-box;
        }

        .page {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100%;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
            position: absolute;
            top: 0;
            left: 0;
            animation: fadeIn 0.5s ease;
            overflow-y: auto;
        }
        
        .page::-webkit-scrollbar { width: 6px; }
        .page::-webkit-scrollbar-track { background: transparent; }
        .page::-webkit-scrollbar-thumb { background-color: rgba(253, 224, 71, 0.5); border-radius: 3px; }
        .page { -ms-overflow-style: none; scrollbar-width: thin; scrollbar-color: rgba(253, 224, 71, 0.5) transparent; }

        .page.active {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –≥—Ä–∏ */
        #game-page {
            justify-content: center;
            gap: 20px;
            overflow: hidden;
        }
        
        #top-ui-container { display: flex; align-items: center; gap: 20px; }
        #score-display { font-size: 48px; font-weight: 700; text-shadow: 0 0 10px rgba(255, 255, 255, 0.3); transition: transform 0.2s ease; }
        #daily-reward-button { background: none; border: none; font-size: 32px; cursor: pointer; display: none; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        .score-pop { animation: score-pop-animation 0.3s ease; }
        @keyframes score-pop-animation { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1); } }
        #click-value-display { position: absolute; font-size: 24px; font-weight: bold; color: var(--text-color); text-shadow: 0 0 5px black; animation: float-up 1s ease-out forwards; pointer-events: none; }
        @keyframes float-up { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-80px); } }
        .critical-hit-text { color: var(--critical-color) !important; font-size: 28px !important; font-weight: 900 !important; }
        #energy-container { display: flex; align-items: center; gap: 10px; background-color: rgba(0,0,0,0.2); padding: 5px 15px; border-radius: 12px; }
        #energy-bar-container { width: 150px; height: 10px; background-color: var(--light-gray); border-radius: 5px; overflow: hidden; }
        #energy-bar { width: 100%; height: 100%; background: linear-gradient(90deg, #10b981, #34d399); border-radius: 5px; transition: width 0.3s ease; }
        #energy-text { font-size: 16px; font-weight: 600; }
        #coin-container { position: relative; margin-top: 20px; }
        #coin { width: 250px; height: 250px; border-radius: 50%; cursor: pointer; transition: transform 0.1s ease, filter 0.3s ease; -webkit-tap-highlight-color: transparent; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; -webkit-user-drag: none; animation: breathing 3s ease-in-out infinite; }
        @keyframes breathing { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        #coin:active { transform: scale(0.95) !important; animation: none; }
        #coin.no-energy { filter: grayscale(100%); cursor: not-allowed; animation: none; }
        .particle { position: absolute; width: 8px; height: 8px; background-color: var(--critical-color); border-radius: 50%; pointer-events: none; opacity: 1; animation: particle-animation 1s ease-out forwards; }
        @keyframes particle-animation { to { transform: translate(var(--x), var(--y)); opacity: 0; } }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω—É, –∫–≤–µ—Å—Ç—ñ–≤, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        #shop-page, #quests-page, #stats-page, #promo-page { padding-top: 30px; padding-bottom: 30px; gap: 15px; }
        .page-title { font-size: 28px; font-weight: 700; margin-bottom: 15px; }
        .shop-item, .quest-item { display: flex; flex-direction: column; width: 90%; max-width: 400px; background-color: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px; }
        .shop-item { flex-direction: row; justify-content: space-between; align-items: center; }
        .shop-item-info, .quest-info { font-size: 18px; font-weight: 600; }
        .shop-item-info small, .quest-info small { font-size: 13px; font-weight: 400; opacity: 0.8; display: block; margin-top: 4px; }
        .buy-button { background-color: var(--yellow); color: var(--dark-gray); border: none; padding: 10px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: background-color 0.2s, transform 0.1s ease; -webkit-tap-highlight-color: transparent; }
        .buy-button:hover { background-color: #facc15; }
        .buy-button:active { transform: scale(0.95); }
        .buy-button.rocket-active, .buy-button:disabled { background-color: var(--light-gray); color: var(--text-color); cursor: not-allowed; opacity: 0.7; }
        .quest-progress-container { display: flex; align-items: center; gap: 15px; margin-top: 10px; }
        .quest-reward { font-weight: 600; color: var(--yellow); }
        .quest-progress-bar-wrapper { flex-grow: 1; height: 12px; background-color: var(--progress-bar-bg); border-radius: 6px; overflow: hidden; }
        .quest-progress-bar { width: 0%; height: 100%; background-color: var(--progress-bar-fill); border-radius: 6px; transition: width 0.5s ease; }
        .claim-quest-btn { margin-top: 10px; width: 100%; }
        .shop-item-buttons { display: flex; gap: 10px; align-items: center; }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –ø–µ—Ä–µ–º–∏–∫–∞—á–∞ –¢–∞–ø –ë–æ—Ç–∞ */
        .toggle-switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #6B7280; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #34D399; }
        input:checked + .slider:before { transform: translateX(26px); }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        #stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 500px; }
        .stat-item { background-color: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px; text-align: center; }
        .stat-icon { font-size: 28px; }
        .stat-value { font-size: 22px; font-weight: 700; margin: 8px 0; }
        .stat-title { font-size: 14px; opacity: 0.8; }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –ö–æ–ª–µ—Å–∞ –§–æ—Ä—Ç—É–Ω–∏ */
        #fortune-wheel-page {
            justify-content: space-between;
            padding-bottom: 110px;
        }
        #wheel-container { position: relative; width: 300px; height: 300px; display: flex; align-items: center; justify-content: center; margin-top: 20px; z-index: 2; }
        #fortune-wheel { width: 100%; height: 100%; }
        #wheel-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 40px; height: 30px; z-index: 10; }
        #spin-wheel-btn { margin-top: auto; font-size: 20px; padding: 15px 40px; min-width: 200px; z-index: 1; }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥—ñ–≤ */
        #promo-page { justify-content: center; }
        #promo-input {
            width: 90%;
            max-width: 400px;
            padding: 15px;
            font-size: 18px;
            border-radius: 12px;
            border: 2px solid var(--light-gray);
            background-color: var(--dark-gray);
            color: var(--text-color);
            text-align: center;
        }
        #promo-input::placeholder { color: var(--light-gray); }
        #submit-promo-btn { width: 90%; max-width: 400px; margin-top: 15px; padding: 15px; }

        /* –õ—ñ—á–∏–ª—å–Ω–∏–∫ —Å–ø—ñ–Ω—ñ–≤ */
        #spin-counter { position: fixed; top: 20px; right: 20px; background-color: rgba(0,0,0,0.4); padding: 8px 15px; border-radius: 12px; font-size: 16px; font-weight: 600; z-index: 1001; backdrop-filter: blur(5px); }

        /* –ù–∞–≤—ñ–≥–∞—Ü—ñ—è */
        nav { 
            position: fixed; 
            left: 10px; 
            top: 50%; 
            transform: translateY(-50%); 
            width: 60px; 
            height: auto; 
            background-color: rgba(40, 40, 40, 0.5); 
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px); 
            padding: 10px 0; 
            border-radius: 20px; 
            z-index: 100; 
            border: 1px solid rgba(255, 255, 255, 0.1); 
        }
        .nav-buttons { 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            gap: 15px;
        }
        .nav-button { background: none; border: none; color: var(--text-color); cursor: pointer; padding: 10px; border-radius: 12px; transition: text-shadow 0.3s ease; font-size: 28px; line-height: 1; -webkit-tap-highlight-color: transparent; }
        .nav-button.active { text-shadow: 0 0 15px var(--yellow), 0 0 5px var(--yellow); }
        
        /* –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è */
        #notification { 
            position: fixed; 
            top: 20px; 
            left: 50%; 
            background-color: rgba(40, 40, 40, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white; 
            padding: 15px 25px; 
            border-radius: 12px; 
            font-weight: 600; 
            z-index: 2001; 
            opacity: 0; 
            transform: translate(-50%, -100px); 
            transition: opacity 0.4s ease, transform 0.4s ease; 
            cursor: grab;
        }
        #notification.show { opacity: 1; transform: translate(-50%, 0); }
        #notification.swiping { transition: none; }
        #notification.swipe-out { transform: translateX(150%); opacity: 0; transition: transform 0.4s ease, opacity 0.4s ease; }
        
        /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: linear-gradient(180deg, #2d260c, #1c1910); padding: 30px; border-radius: 20px; text-align: center; width: 90%; max-width: 350px; border: 1px solid rgba(255, 255, 255, 0.1); animation: zoomIn 0.3s ease; }
        @keyframes zoomIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-content h2 { margin-top: 0; font-size: 24px; }
        .modal-content p { font-size: 18px; margin: 15px 0; }
        .modal-reward { font-size: 32px; font-weight: 700; color: var(--yellow); margin: 20px 0; }
        .modal-close-btn { position: absolute; top: 10px; right: 15px; background: none; border: none; color: white; font-size: 24px; cursor: pointer; }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å */
        @media (max-width: 480px) {
            .page-container { padding-left: 70px; }
            nav { width: 50px; }
            #score-display { font-size: 40px; }
            #coin { width: 200px; height: 200px; }
            .shop-item-info, .quest-info { font-size: 16px; }
            .buy-button { padding: 8px 16px; }
            #stats-grid { grid-template-columns: 1fr; }
            #wheel-container { width: 280px; height: 280px; }
        }

    </style>
</head>
<body>
    <div id="spin-counter">üé° 4</div>

    <div class="page-container">
        <!-- –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≥—Ä–∏ -->
        <div id="game-page" class="page active">
            <div id="top-ui-container"><div id="score-display">0</div><button id="daily-reward-button">üéÅ</button></div>
            <div id="energy-container"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" fill="#34d399" stroke="#10b981" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg><div id="energy-bar-container"><div id="energy-bar"></div></div><div id="energy-text">175 / 175</div></div>
            <div id="coin-container"><img id="coin" src="https://i.ibb.co/cXyq1bpQ/3bc6fbe4-9596-4477-96e0-c0ba678d5d1a.png" alt="[–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–æ–Ω–µ—Ç–∏ —î–Ω–æ—Ç–∞]"></div>
        </div>

        <!-- –°—Ç–æ—Ä—ñ–Ω–∫–∞ –º–∞–≥–∞–∑–∏–Ω—É -->
        <div id="shop-page" class="page">
            <h1 class="page-title">–ú–∞–≥–∞–∑–∏–Ω</h1>
            <div class="shop-item">
                <div class="shop-item-info">–°–∏–ª–∞ –∫–ª—ñ–∫—É<small id="click-power-level">–†—ñ–≤–µ–Ω—å: 1 (+1 –∑–∞ –∫–ª—ñ–∫)</small></div>
                <button id="buy-click-power" class="buy-button">30</button>
            </div>
            <div class="shop-item">
                <div class="shop-item-info">–ú–∞–∫—Å. –µ–Ω–µ—Ä–≥—ñ—è<small id="max-energy-level">–†—ñ–≤–µ–Ω—å: 1 (175 –º–∞–∫—Å.)</small></div>
                <button id="buy-max-energy" class="buy-button">27</button>
            </div>
            <div class="shop-item">
                <div class="shop-item-info">–†–∞–∫–µ—Ç–∞<small id="rocket-level">x2.7 –Ω–∞ 6.0 —Å–µ–∫</small></div>
                <button id="buy-rocket" class="buy-button">65</button>
            </div>
            <div class="shop-item">
                <div class="shop-item-info">–¢–∞–ø –ë–æ—Ç<small id="tap-bot-level">–†—ñ–≤–µ–Ω—å: 0 (1 –∫–ª—ñ–∫ / 3.0—Å)</small></div>
                <div class="shop-item-buttons">
                    <label class="toggle-switch">
                        <input type="checkbox" id="toggle-tap-bot-checkbox">
                        <span class="slider"></span>
                    </label>
                    <button id="buy-tap-bot" class="buy-button">730</button>
                </div>
            </div>
             <div class="shop-item">
                <div class="shop-item-info">–ü–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó<small>–í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –µ–Ω–µ—Ä–≥—ñ—é –¥–æ –º–∞–∫—Å–∏–º—É–º—É</small></div>
                <button id="buy-energy-refill" class="buy-button">280</button>
            </div>
        </div>
        
        <!-- –°—Ç–æ—Ä—ñ–Ω–∫–∞ –∫–≤–µ—Å—Ç—ñ–≤ -->
        <div id="quests-page" class="page"><h1 class="page-title">–ö–≤–µ—Å—Ç–∏</h1><div id="quest-list" style="width: 100%; display: flex; flex-direction: column; gap: 15px; align-items: center;"></div></div>
        
        <!-- –°—Ç–æ—Ä—ñ–Ω–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div id="stats-page" class="page"><h1 class="page-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1><div id="stats-grid"></div></div>

        <!-- –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ö–æ–ª–µ—Å–∞ –§–æ—Ä—Ç—É–Ω–∏ -->
        <div id="fortune-wheel-page" class="page">
            <h1 class="page-title">–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω–∏</h1>
            <div id="wheel-container">
                <canvas id="fortune-wheel"></canvas>
                <div id="wheel-pointer">
                    <svg viewBox="0 0 40 30" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: 100%; fill: var(--yellow);">
                        <path d="M20,30 L2,5 C-2,-5 42,-5 38,5 Z" />
                    </svg>
                </div>
            </div>
            <button id="spin-wheel-btn" class="buy-button">–ö—Ä—É—Ç–∏—Ç–∏</button>
        </div>

        <!-- –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ü—Ä–æ–º–æ–∫–æ–¥—ñ–≤ -->
        <div id="promo-page" class="page">
            <h1 class="page-title">–ü—Ä–æ–º–æ–∫–æ–¥–∏</h1>
            <input type="text" id="promo-input" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥">
            <button id="submit-promo-btn" class="buy-button">–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏</button>
        </div>
    </div>

    <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω–∞ –ø–∞–Ω–µ–ª—å -->
    <nav>
        <div class="nav-buttons">
            <button id="home-btn" class="nav-button active">ü¶ù</button>
            <button id="stats-btn" class="nav-button">üìä</button>
            <button id="quests-btn" class="nav-button">üèÜ</button>
            <button id="wheel-btn" class="nav-button">üé°</button>
            <button id="promo-btn" class="nav-button">üé´</button>
            <button id="shop-btn" class="nav-button">üõí</button>
        </div>
    </nav>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è —â–æ–¥–µ–Ω–Ω–æ—ó –Ω–∞–≥–æ—Ä–æ–¥–∏ -->
    <div id="daily-reward-modal" class="modal-overlay"><div class="modal-content"><button id="close-reward-modal" class="modal-close-btn">&times;</button><h2>–©–æ–¥–µ–Ω–Ω–∞ –Ω–∞–≥–æ—Ä–æ–¥–∞!</h2><p>–ü–æ–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è –∑–∞–≤—Ç—Ä–∞ –∑–∞ –Ω–æ–≤–∏–º –±–æ–Ω—É—Å–æ–º.</p><div class="modal-reward">üéÅ <span id="reward-amount">0</span></div><button id="claim-reward-btn" class="buy-button">–û—Ç—Ä–∏–º–∞—Ç–∏</button></div></div>

    <!-- –ï–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å -->
    <div id="notification"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM –µ–ª–µ–º–µ–Ω—Ç–∏ ---
            const scoreDisplay = document.getElementById('score-display');
            const coin = document.getElementById('coin');
            const coinContainer = document.getElementById('coin-container');
            const energyBar = document.getElementById('energy-bar');
            const energyText = document.getElementById('energy-text');
            const notification = document.getElementById('notification');
            const spinCounterDisplay = document.getElementById('spin-counter');
            
            // –ù–∞–≤—ñ–≥–∞—Ü—ñ—è
            const homeBtn = document.getElementById('home-btn');
            const shopBtn = document.getElementById('shop-btn');
            const questsBtn = document.getElementById('quests-btn');
            const statsBtn = document.getElementById('stats-btn');
            const wheelBtn = document.getElementById('wheel-btn');
            const promoBtn = document.getElementById('promo-btn');
            const gamePage = document.getElementById('game-page');
            const shopPage = document.getElementById('shop-page');
            const questsPage = document.getElementById('quests-page');
            const statsPage = document.getElementById('stats-page');
            const wheelPage = document.getElementById('fortune-wheel-page');
            const promoPage = document.getElementById('promo-page');
            const questListContainer = document.getElementById('quest-list');
            const statsGridContainer = document.getElementById('stats-grid');

            // –ú–∞–≥–∞–∑–∏–Ω
            const buyClickPowerBtn = document.getElementById('buy-click-power');
            const buyMaxEnergyBtn = document.getElementById('buy-max-energy');
            const buyRocketBtn = document.getElementById('buy-rocket');
            const buyTapBotBtn = document.getElementById('buy-tap-bot');
            const toggleTapBotCheckbox = document.getElementById('toggle-tap-bot-checkbox');
            const buyEnergyRefillBtn = document.getElementById('buy-energy-refill');
            const clickPowerLevelDisplay = document.getElementById('click-power-level');
            const maxEnergyLevelDisplay = document.getElementById('max-energy-level');
            const rocketLevelDisplay = document.getElementById('rocket-level');
            const tapBotLevelDisplay = document.getElementById('tap-bot-level');

            // –©–æ–¥–µ–Ω–Ω—ñ –Ω–∞–≥–æ—Ä–æ–¥–∏
            const dailyRewardModal = document.getElementById('daily-reward-modal');
            const closeRewardModalBtn = document.getElementById('close-reward-modal');
            const claimRewardBtn = document.getElementById('claim-reward-btn');
            const rewardAmountSpan = document.getElementById('reward-amount');
            const dailyRewardBtn = document.getElementById('daily-reward-button');

            // –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω–∏
            const wheelCanvas = document.getElementById('fortune-wheel');
            const spinBtn = document.getElementById('spin-wheel-btn');
            const ctx = wheelCanvas.getContext('2d');

            // –ü—Ä–æ–º–æ–∫–æ–¥–∏
            const promoInput = document.getElementById('promo-input');
            const submitPromoBtn = document.getElementById('submit-promo-btn');

            // --- –î–∞–Ω—ñ –≥—Ä–∏ ---
            const allQuests = [
                { id: 'q1', title: '–ü–µ—Ä—à—ñ –∫—Ä–æ–∫–∏', description: '–ó—Ä–æ–±—ñ—Ç—å 100 –∫–ª—ñ–∫—ñ–≤', targetStat: 'totalClicks', goal: 100, reward: 50 },
                { id: 'q2', title: '–ü–æ—á–∞—Ç–∫—ñ–≤–µ—Ü—å-–∫–ª—ñ–∫–µ—Ä', description: '–ó—Ä–æ–±—ñ—Ç—å 1,000 –∫–ª—ñ–∫—ñ–≤', targetStat: 'totalClicks', goal: 1000, reward: 250 },
                { id: 'q3', title: '–©–∞—Å–ª–∏–≤–∏–π –≤–∏–ø–∞–¥–æ–∫', description: '–ó—Ä–æ–±—ñ—Ç—å 10 –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –∫–ª—ñ–∫—ñ–≤', targetStat: 'criticalClicks', goal: 10, reward: 100 },
                { id: 'q4', title: '–ü–µ—Ä—à–∏–π –∫–∞–ø—ñ—Ç–∞–ª', description: '–ó–∞—Ä–æ–±—ñ—Ç—å 1,000 –º–æ–Ω–µ—Ç', targetStat: 'totalCoinsEarned', goal: 1000, reward: 200 },
                { id: 'q5', title: '–ë—ñ–ª—å—à–µ —Å–∏–ª–∏!', description: '–ö—É–ø—ñ—Ç—å 5 –ø–æ–∫—Ä–∞—â–µ–Ω—å —Å–∏–ª–∏ –∫–ª—ñ–∫—É', targetStat: 'clickPowerUpgrades', goal: 5, reward: 300 },
                { id: 'q6', title: '–ï–Ω–µ—Ä–≥–µ—Ç–∏–∫', description: '–ö—É–ø—ñ—Ç—å 5 –ø–æ–∫—Ä–∞—â–µ–Ω—å –µ–Ω–µ—Ä–≥—ñ—ó', targetStat: 'energyUpgrades', goal: 5, reward: 300 },
                { id: 'q7', title: '–†–∞–∫–µ—Ç–Ω–∏–∫', description: '–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —Ä–∞–∫–µ—Ç—É 3 —Ä–∞–∑–∏', targetStat: 'rocketsUsed', goal: 3, reward: 500 },
                { id: 'q8', title: '–ö—Ä–∏—Ç–∏—á–Ω–∞ –º–∞—Å–∞', description: '–ó—Ä–æ–±—ñ—Ç—å 100 –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –∫–ª—ñ–∫—ñ–≤', targetStat: 'criticalClicks', goal: 100, reward: 750 },
                { id: 'q9', title: '–ú–∞–π—Å—Ç–µ—Ä –∫–ª—ñ–∫—ñ–≤', description: '–ó—Ä–æ–±—ñ—Ç—å 10,000 –∫–ª—ñ–∫—ñ–≤', targetStat: 'totalClicks', goal: 10000, reward: 1500 },
                { id: 'q10', title: '–ë–∞–≥–∞—Ç—ñ–π', description: '–ó–∞—Ä–æ–±—ñ—Ç—å 25,000 –º–æ–Ω–µ—Ç', targetStat: 'totalCoinsEarned', goal: 25000, reward: 2000 },
                { id: 'q11', title: '–°–∏–ª–∞ –≤ —Ä—É–∫–∞—Ö', description: '–î–æ—Å—è–≥–Ω—ñ—Ç—å 10 —Ä—ñ–≤–Ω—è —Å–∏–ª–∏ –∫–ª—ñ–∫—É', targetStat: 'clickPowerLevel', goal: 10, reward: 1000 },
                { id: 'q12', title: '–ù–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∞ –µ–Ω–µ—Ä–≥—ñ—è', description: '–î–æ—Å—è–≥–Ω—ñ—Ç—å 10 —Ä—ñ–≤–Ω—è –º–∞–∫—Å. –µ–Ω–µ—Ä–≥—ñ—ó', targetStat: 'energyLevel', goal: 10, reward: 1000 },
                { id: 'q13', title: '–ó–∞–≤–∑—è—Ç–∏–π –∫–ª—ñ–∫–µ—Ä', description: '–ó—Ä–æ–±—ñ—Ç—å 50,000 –∫–ª—ñ–∫—ñ–≤', targetStat: 'totalClicks', goal: 50000, reward: 5000 },
                { id: 'q14', title: '–§–æ—Ä—Ç—É–Ω–∞ –≤–∞–º –ø–æ—Å–º—ñ—Ö–∞—î—Ç—å—Å—è', description: '–ó—Ä–æ–±—ñ—Ç—å 500 –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –∫–ª—ñ–∫—ñ–≤', targetStat: 'criticalClicks', goal: 500, reward: 4000 },
                { id: 'q15', title: '–ú—ñ–ª—å–π–æ–Ω–µ—Ä', description: '–ó–∞—Ä–æ–±—ñ—Ç—å 100,000 –º–æ–Ω–µ—Ç', targetStat: 'totalCoinsEarned', goal: 100000, reward: 10000 },
                { id: 'q16', title: '–†–∞–∫–µ—Ç–Ω–∏–π –±–∞—Ä–æ–Ω', description: '–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ 10 —Ä–∞–∫–µ—Ç', targetStat: 'rocketsUsed', goal: 10, reward: 5000 },
                { id: 'q17', title: '–ú–æ–≥—É—Ç–Ω—ñ–π –∫–ª—ñ–∫', description: '–ö—É–ø—ñ—Ç—å 25 –ø–æ–∫—Ä–∞—â–µ–Ω—å —Å–∏–ª–∏ –∫–ª—ñ–∫—É', targetStat: 'clickPowerUpgrades', goal: 25, reward: 7500 },
                { id: 'q18', title: '–ï–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–∏–π –º–∞–≥–Ω–∞—Ç', description: '–ö—É–ø—ñ—Ç—å 25 –ø–æ–∫—Ä–∞—â–µ–Ω—å –µ–Ω–µ—Ä–≥—ñ—ó', targetStat: 'energyUpgrades', goal: 25, reward: 7500 },
                { id: 'q19', title: '–õ–µ–≥–µ–Ω–¥–∞ –∫–ª—ñ–∫—ñ–≤', description: '–ó—Ä–æ–±—ñ—Ç—å 250,000 –∫–ª—ñ–∫—ñ–≤', targetStat: 'totalClicks', goal: 250000, reward: 20000 },
                { id: 'q20', title: '–í–æ–ª–æ–¥–∞—Ä –∫—Ä–∏—Ç—ñ–≤', description: '–ó—Ä–æ–±—ñ—Ç—å 2,500 –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –∫–ª—ñ–∫—ñ–≤', targetStat: 'criticalClicks', goal: 2500, reward: 15000 },
                { id: 'q21', title: '–°–µ–∫—Ä–µ—Ç–Ω–∏–π –±–æ–Ω—É—Å', description: '–ó–Ω–∞–π–¥—ñ—Ç—å –ø–∞—Å—Ö–∞–ª–∫—É', targetStat: 'easterEggFound', goal: 1, reward: 1000 },
                { id: 'q22', title: '–ö–æ—Å–º—ñ—á–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞', description: '–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ 25 —Ä–∞–∫–µ—Ç', targetStat: 'rocketsUsed', goal: 25, reward: 15000 },
                { id: 'q23', title: '–¢–∏—Ç–∞–Ω —Å–∏–ª–∏', description: '–î–æ—Å—è–≥–Ω—ñ—Ç—å 30 —Ä—ñ–≤–Ω—è —Å–∏–ª–∏ –∫–ª—ñ–∫—É', targetStat: 'clickPowerLevel', goal: 30, reward: 10000 },
                { id: 'q24', title: '–ï–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–µ —è–¥—Ä–æ', description: '–î–æ—Å—è–≥–Ω—ñ—Ç—å 30 —Ä—ñ–≤–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó', targetStat: 'energyLevel', goal: 30, reward: 10000 },
                { id: 'q25', title: '–ú–∞–≥–Ω–∞—Ç', description: '–ó–∞—Ä–æ–±—ñ—Ç—å 1,000,000 –º–æ–Ω–µ—Ç', targetStat: 'totalCoinsEarned', goal: 1000000, reward: 50000 },
                { id: 'q26', title: '–ë–æ–≥ –∫–ª—ñ–∫—ñ–≤', description: '–ó—Ä–æ–±—ñ—Ç—å 1,000,000 –∫–ª—ñ–∫—ñ–≤', targetStat: 'totalClicks', goal: 1000000, reward: 100000 },
                { id: 'q27', title: '–í–∏—Ç—Ä–∞—á–µ–Ω–∞ –µ–Ω–µ—Ä–≥—ñ—è', description: '–í–∏—Ç—Ä–∞—Ç—å—Ç–µ 10,000 –µ–Ω–µ—Ä–≥—ñ—ó', targetStat: 'energySpent', goal: 10000, reward: 5000 },
                { id: 'q28', title: '–ü–æ–≤–µ–ª–∏—Ç–µ–ª—å —É–¥–∞—á—ñ', description: '–ó—Ä–æ–±—ñ—Ç—å 10,000 –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –∫–ª—ñ–∫—ñ–≤', targetStat: 'criticalClicks', goal: 10000, reward: 75000 },
                { id: 'q29', title: '–†–∞–∫–µ—Ç–Ω–∞ —Ñ–ª–æ—Ç–∏–ª—ñ—è', description: '–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ 50 —Ä–∞–∫–µ—Ç', targetStat: 'rocketsUsed', goal: 50, reward: 50000 },
                { id: 'q30', title: '–ù–µ—Å—Ç—Ä–∏–º–Ω–∏–π', description: '–ó–∞—Ä–æ–±—ñ—Ç—å 10,000,000 –º–æ–Ω–µ—Ç', targetStat: 'totalCoinsEarned', goal: 10000000, reward: 250000 },
            ];

            const defaultState = {
                score: 0, energy: 175, maxEnergy: 175, clickPower: 1,
                rocketActive: false, rocketMultiplier: 2.7, rocketDuration: 6,
                easterEggTriggered: false, lastRewardDate: null,
                dailySpins: 4, lastSpinDate: null,
                tempCritChanceBonus: 0, tempEnergyRegenBonus: 1,
                tapBotLevel: 0, tapBotSpeed: 3, tapBotEnabled: false, lastOfflineTimestamp: null,
                costs: { clickPower: 30, maxEnergy: 27, rocket: 65, tapBot: 730 },
                levels: { clickPower: 1, maxEnergy: 1, rocket: 1 },
                stats: {
                    totalClicks: 0, criticalClicks: 0, totalCoinsEarned: 0, energySpent: 0,
                    clickPowerUpgrades: 0, energyUpgrades: 0, rocketsUsed: 0,
                    clickPowerLevel: 1, energyLevel: 1, easterEggFound: 0, timePlayed: 0,
                },
                claimedQuests: {},
                usedPromoCodes: [],
            };

            let gameState = {};
            let dailyRewardAmount = 0;
            let tapBotInterval = null;

            // --- –§—É–Ω–∫—Ü—ñ—ó –≥—Ä–∏ ---
            function loadGame() {
                const savedState = localStorage.getItem('raccoonCoinState');
                if (savedState) {
                    const parsedState = JSON.parse(savedState);
                    gameState = { ...defaultState, ...parsedState };
                    gameState.costs = { ...defaultState.costs, ...parsedState.costs };
                    gameState.levels = { ...defaultState.levels, ...parsedState.levels };
                    gameState.stats = { ...defaultState.stats, ...parsedState.stats };
                    gameState.claimedQuests = parsedState.claimedQuests || {};
                    gameState.usedPromoCodes = parsedState.usedPromoCodes || [];
                } else {
                    gameState = JSON.parse(JSON.stringify(defaultState));
                }
                
                calculateOfflineEarnings();
                
                checkDailyReward();
                checkDailySpins();
                updateUI();
                drawWheel(0);
                
                if (gameState.tapBotEnabled) {
                    startTapBot();
                }
            }

            function saveGame() {
                gameState.lastOfflineTimestamp = Date.now();
                localStorage.setItem('raccoonCoinState', JSON.stringify(gameState));
            }

            function updateUI() {
                scoreDisplay.textContent = Math.floor(gameState.score);
                const energyPercentage = (gameState.energy / gameState.maxEnergy) * 100;
                energyBar.style.width = `${energyPercentage}%`;
                energyText.textContent = `${Math.floor(gameState.energy)} / ${gameState.maxEnergy}`;
                coin.classList.toggle('no-energy', gameState.energy <= 0);
                buyClickPowerBtn.textContent = Math.round(gameState.costs.clickPower);
                buyMaxEnergyBtn.textContent = Math.round(gameState.costs.maxEnergy);
                buyRocketBtn.textContent = Math.round(gameState.costs.rocket);
                clickPowerLevelDisplay.innerHTML = `–†—ñ–≤–µ–Ω—å: ${gameState.levels.clickPower} (+${gameState.clickPower} –∑–∞ –∫–ª—ñ–∫)`;
                maxEnergyLevelDisplay.innerHTML = `–†—ñ–≤–µ–Ω—å: ${gameState.levels.maxEnergy} (${gameState.maxEnergy} –º–∞–∫—Å.)`;
                rocketLevelDisplay.innerHTML = `x${gameState.rocketMultiplier.toFixed(1)} –Ω–∞ ${gameState.rocketDuration.toFixed(1)} —Å–µ–∫`;
                updateTapBotUI();
                updateSpinCounterUI();
            }
            
            function updateSpinCounterUI() {
                spinCounterDisplay.innerHTML = `üé° ${gameState.dailySpins}`;
                spinBtn.disabled = gameState.dailySpins <= 0 || isSpinning;
                spinBtn.textContent = gameState.dailySpins > 0 ? '–ö—Ä—É—Ç–∏—Ç–∏' : '–°–ø—ñ–Ω–∏ —Å–∫—ñ–Ω—á–∏–ª–∏—Å—å';
            }

            let notificationTimeout;
            function showNotification(message, type = 'error') {
                clearTimeout(notificationTimeout);
                notification.textContent = message;
                notification.style.backgroundColor = type === 'bonus' ? 'rgba(52, 211, 153, 0.6)' : 'rgba(239, 68, 68, 0.6)';
                notification.classList.remove('swipe-out');
                notification.style.transform = 'translateX(-50%) translateY(-100px)';
                notification.classList.add('show');
                
                notificationTimeout = setTimeout(() => {
                    notification.classList.remove('show');
                }, 4000);
            }
            
            function handleCoinClick(event) {
                if (gameState.energy <= 0) { showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –µ–Ω–µ—Ä–≥—ñ—ó!"); return; }
                gameState.energy -= 1;
                gameState.stats.energySpent += 1;
                gameState.stats.totalClicks += 1;
                let clickValue = gameState.clickPower;
                let isCritical = false;
                const critChance = 0.15 + gameState.tempCritChanceBonus;
                if (Math.random() < critChance) { 
                    clickValue *= 2; 
                    isCritical = true; 
                    gameState.stats.criticalClicks += 1; 
                    createParticles(); 
                }
                if (gameState.rocketActive) { clickValue *= gameState.rocketMultiplier; }
                clickValue = Math.round(clickValue);
                gameState.score += clickValue;
                gameState.stats.totalCoinsEarned += clickValue;
                showClickValue(clickValue, isCritical, event);
                scoreDisplay.classList.add('score-pop');
                scoreDisplay.addEventListener('animationend', () => scoreDisplay.classList.remove('score-pop'), { once: true });
                updateUI();
            }

            // --- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è ---
            function switchPage(pageId) {
                [gamePage, shopPage, questsPage, statsPage, wheelPage, promoPage].forEach(p => p.classList.remove('active'));
                [homeBtn, shopBtn, questsBtn, statsBtn, wheelBtn, promoBtn].forEach(b => b.classList.remove('active'));
                
                const page = document.getElementById(pageId);
                page.classList.add('active');

                if (pageId === 'quests-page') { questsBtn.classList.add('active'); populateQuests(); } 
                else if (pageId === 'shop-page') { shopBtn.classList.add('active'); } 
                else if (pageId === 'stats-page') { statsBtn.classList.add('active'); populateStats(); }
                else if (pageId === 'fortune-wheel-page') { 
                    wheelBtn.classList.add('active');
                    if (isSpinning) {
                        isSpinning = false;
                        if(animationFrameId) cancelAnimationFrame(animationFrameId);
                    }
                    updateSpinCounterUI();
                }
                else if (pageId === 'promo-page') { promoBtn.classList.add('active'); }
                else { homeBtn.classList.add('active'); }
            }
            homeBtn.addEventListener('click', () => switchPage('game-page'));
            shopBtn.addEventListener('click', () => switchPage('shop-page'));
            questsBtn.addEventListener('click', () => switchPage('quests-page'));
            statsBtn.addEventListener('click', () => switchPage('stats-page'));
            wheelBtn.addEventListener('click', () => switchPage('fortune-wheel-page'));
            promoBtn.addEventListener('click', () => switchPage('promo-page'));

            // --- –°—Ç–æ—Ä—ñ–Ω–∫–∏ ---
            function populateQuests() {
                questListContainer.innerHTML = '';
                allQuests.forEach(quest => {
                    const currentProgress = gameState.stats[quest.targetStat] || 0;
                    const isClaimed = gameState.claimedQuests[quest.id];
                    const questItem = document.createElement('div');
                    questItem.className = 'quest-item';
                    questItem.innerHTML = `<div class="quest-info">${quest.title}<small>${quest.description} (${Math.min(currentProgress, quest.goal)} / ${quest.goal})</small></div><div class="quest-progress-container"><span class="quest-reward">üí∞ ${quest.reward}</span><div class="quest-progress-bar-wrapper"><div class="quest-progress-bar" style="width: ${Math.min(currentProgress / quest.goal * 100, 100)}%;"></div></div></div><button class="buy-button claim-quest-btn" data-quest-id="${quest.id}" ${currentProgress < quest.goal || isClaimed ? 'disabled' : ''}>${isClaimed ? '–û—Ç—Ä–∏–º–∞–Ω–æ' : '–û—Ç—Ä–∏–º–∞—Ç–∏'}</button>`;
                    questListContainer.appendChild(questItem);
                });
            }
            
            function populateStats() {
                statsGridContainer.innerHTML = '';
                const formatTime = (seconds) => {
                    const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
                    const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
                    const s = Math.floor(seconds % 60).toString().padStart(2, '0');
                    return `${h}:${m}:${s}`;
                };

                const statsToDisplay = [
                    { icon: 'üëÜ', title: '–í—Å—å–æ–≥–æ –∫–ª—ñ–∫—ñ–≤', value: gameState.stats.totalClicks.toLocaleString() },
                    { icon: 'üí•', title: '–ö—Ä–∏—Ç–∏—á–Ω–∏—Ö –∫–ª—ñ–∫—ñ–≤', value: gameState.stats.criticalClicks.toLocaleString() },
                    { icon: 'üí∞', title: '–ó–∞—Ä–æ–±–ª–µ–Ω–æ –º–æ–Ω–µ—Ç', value: Math.floor(gameState.stats.totalCoinsEarned).toLocaleString() },
                    { icon: 'üîã', title: '–í–∏—Ç—Ä–∞—á–µ–Ω–æ –µ–Ω–µ—Ä–≥—ñ—ó', value: gameState.stats.energySpent.toLocaleString() },
                    { icon: 'üöÄ', title: '–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —Ä–∞–∫–µ—Ç', value: gameState.stats.rocketsUsed.toLocaleString() },
                    { icon: 'üèÜ', title: '–í–∏–∫–æ–Ω–∞–Ω–æ –∫–≤–µ—Å—Ç—ñ–≤', value: Object.keys(gameState.claimedQuests).length },
                    { icon: 'üí™', title: '–°–∏–ª–∞ –∫–ª—ñ–∫—É', value: gameState.clickPower.toLocaleString() },
                    { icon: '‚ö°Ô∏è', title: '–ú–∞–∫—Å. –µ–Ω–µ—Ä–≥—ñ—è', value: gameState.maxEnergy.toLocaleString() },
                    { icon: '‚è∞', title: '–ß–∞—Å —É –≥—Ä—ñ', value: formatTime(gameState.stats.timePlayed) },
                    { icon: 'ü§ñ', title: '–†—ñ–≤–µ–Ω—å –¢–∞–ø –ë–æ—Ç–∞', value: gameState.tapBotLevel },
                ];

                statsToDisplay.forEach(stat => {
                    const statItem = document.createElement('div');
                    statItem.className = 'stat-item';
                    statItem.innerHTML = `<div class="stat-icon">${stat.icon}</div><div class="stat-value">${stat.value}</div><div class="stat-title">${stat.title}</div>`;
                    statsGridContainer.appendChild(statItem);
                });
            }

            questListContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('claim-quest-btn')) {
                    const questId = e.target.dataset.questId;
                    const quest = allQuests.find(q => q.id === questId);
                    if (quest && !gameState.claimedQuests[quest.id] && (gameState.stats[quest.targetStat] || 0) >= quest.goal) {
                        gameState.score += quest.reward;
                        gameState.claimedQuests[quest.id] = true;
                        showNotification(`–ù–∞–≥–æ—Ä–æ–¥–∞ ${quest.reward} –º–æ–Ω–µ—Ç –æ—Ç—Ä–∏–º–∞–Ω–∞!`, 'bonus');
                        e.target.disabled = true;
                        e.target.textContent = '–û—Ç—Ä–∏–º–∞–Ω–æ';
                        updateUI();
                    }
                }
            });
            
            // --- –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω–∏ ---
            const wheelSegments = [
                { text: '25k', type: 'coins', value: 25000 },
                { text: '–†–∞–∫–µ—Ç–∞', type: 'rocket' },
                { text: 'x2 –†–µ–≥–µ–Ω', type: 'energy_regen', duration: 60 },
                { text: '+10% –ö—Ä–∏—Ç', type: 'crit_chance', duration: 60, value: 0.1 },
                { text: '2.5k', type: 'coins', value: 2500 },
                { text: '+500 –ï–Ω', type: 'energy_boost', value: 500 },
                { text: '1k', type: 'coins', value: 1000 },
                { text: '100', type: 'coins', value: 100 },
            ];
            let currentAngle = 0;
            let isSpinning = false;
            let animationFrameId = null;
            const segmentAngleRad = (2 * Math.PI) / wheelSegments.length;

            function drawWheel(rotationAngle = 0) {
                const container = document.getElementById('wheel-container');
                wheelCanvas.width = container.clientWidth;
                wheelCanvas.height = container.clientHeight;
                const radius = wheelCanvas.width / 2;
                const center = radius;

                ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
                ctx.save();
                ctx.translate(center, center);
                ctx.rotate(rotationAngle);

                wheelSegments.forEach((segment, i) => {
                    const startAngle = i * segmentAngleRad;
                    
                    ctx.save();
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.arc(0, 0, radius - 5, startAngle, startAngle + segmentAngleRad);
                    ctx.closePath();
                    ctx.clip(); 

                    ctx.fillStyle = '#555960';
                    ctx.fill();

                    ctx.fillStyle = 'white';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    const textAngle = startAngle + segmentAngleRad / 2;
                    ctx.save();
                    ctx.rotate(textAngle);
                    
                    ctx.font = 'bold 16px Inter';
                    ctx.fillText(segment.text, radius * 0.65, 0);
                    
                    ctx.restore();
                    ctx.restore(); 
                });

                wheelSegments.forEach((segment, i) => {
                    const startAngle = i * segmentAngleRad;
                    ctx.beginPath();
                    ctx.moveTo(0,0);
                    ctx.arc(0, 0, radius - 5, startAngle, startAngle);
                    ctx.lineTo(0,0);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                });

                ctx.beginPath();
                ctx.arc(0,0,20,0, 2*Math.PI);
                ctx.fillStyle = '#4a3f00';
                ctx.fill();
                ctx.beginPath();
                ctx.arc(0,0,15,0, 2*Math.PI);
                ctx.fillStyle = '#1c1910';
                ctx.fill();

                ctx.restore();
            }

            function checkDailySpins() {
                const today = new Date().toDateString();
                if (gameState.lastSpinDate !== today) {
                    gameState.dailySpins = 4;
                    gameState.lastSpinDate = today;
                }
                updateSpinCounterUI();
            }

            spinBtn.addEventListener('click', () => {
                if (isSpinning || gameState.dailySpins <= 0) return;
                
                gameState.dailySpins--;
                isSpinning = true;
                updateSpinCounterUI();

                const spinDuration = 7000;
                const totalRotation = (Math.random() * 2 + 5) * 2 * Math.PI;
                const startAngle = currentAngle;
                let startTime = null;

                function animateWheel(timestamp) {
                    if (!startTime) startTime = timestamp;
                    const elapsedTime = timestamp - startTime;
                    
                    if (elapsedTime >= spinDuration) {
                        isSpinning = false;
                        updateSpinCounterUI();
                        const finalAngle = (startAngle + totalRotation) % (2 * Math.PI);
                        const pointerAngle = 1.5 * Math.PI; // Top of the wheel
                        const correctedAngle = (2 * Math.PI + pointerAngle - finalAngle) % (2 * Math.PI);
                        const winningSegmentIndex = Math.floor(correctedAngle / segmentAngleRad);
                        const prize = wheelSegments[winningSegmentIndex];
                        awardPrize(prize);
                        return;
                    }

                    const progress = elapsedTime / spinDuration;
                    const easedProgress = 1 - Math.pow(1 - progress, 4);
                    currentAngle = startAngle + totalRotation * easedProgress;
                    drawWheel(currentAngle);

                    animationFrameId = requestAnimationFrame(animateWheel);
                }
                animationFrameId = requestAnimationFrame(animateWheel);
            });

            function awardPrize(prize) {
                switch (prize.type) {
                    case 'coins':
                        gameState.score += prize.value;
                        showNotification(`–í–∏ –≤–∏–≥—Ä–∞–ª–∏ ${prize.value} –º–æ–Ω–µ—Ç!`, 'bonus');
                        break;
                    case 'energy_boost':
                        gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + prize.value);
                        showNotification(`–í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ +${prize.value} –µ–Ω–µ—Ä–≥—ñ—ó!`, 'bonus');
                        break;
                    case 'rocket':
                        if (gameState.score >= gameState.costs.rocket) {
                             buyRocketBtn.click();
                        } else {
                            showNotification('–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ —Ä–∞–∫–µ—Ç–∞!', 'bonus');
                            gameState.rocketActive = true; 
                            gameState.stats.rocketsUsed++;
                            setTimeout(() => { gameState.rocketActive = false; }, gameState.rocketDuration * 1000);
                        }
                        break;
                    case 'energy_regen':
                        showNotification(`–ü–æ–¥–≤–æ—î–Ω–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –µ–Ω–µ—Ä–≥—ñ—ó –Ω–∞ ${prize.duration}—Å!`, 'bonus');
                        gameState.tempEnergyRegenBonus = 2;
                        setTimeout(() => {
                            gameState.tempEnergyRegenBonus = 1;
                            showNotification('–ë–æ–Ω—É—Å —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è.');
                        }, prize.duration * 1000);
                        break;
                     case 'crit_chance':
                        showNotification(`–®–∞–Ω—Å –∫—Ä–∏—Ç. —É–¥–∞—Ä—É +10% –Ω–∞ ${prize.duration}—Å!`, 'bonus');
                        gameState.tempCritChanceBonus = prize.value;
                        setTimeout(() => {
                            gameState.tempCritChanceBonus = 0;
                            showNotification('–ë–æ–Ω—É—Å –∫—Ä–∏—Ç. —à–∞–Ω—Å—É –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è.');
                        }, prize.duration * 1000);
                        break;
                }
                updateUI();
            }


            // --- –ü–æ–∫—É–ø–∫–∏ ---
            buyClickPowerBtn.addEventListener('click', () => { const c = Math.round(gameState.costs.clickPower); if (gameState.score >= c) { gameState.score -= c; gameState.clickPower++; gameState.levels.clickPower++; gameState.stats.clickPowerUpgrades++; gameState.stats.clickPowerLevel = gameState.levels.clickPower; gameState.costs.clickPower *= 1.5; updateUI(); } else { showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –æ—á–æ–∫!"); } });
            buyMaxEnergyBtn.addEventListener('click', () => { const c = Math.round(gameState.costs.maxEnergy); if (gameState.score >= c) { gameState.score -= c; gameState.maxEnergy += 45; gameState.levels.maxEnergy++; gameState.stats.energyUpgrades++; gameState.stats.energyLevel = gameState.levels.maxEnergy; gameState.costs.maxEnergy *= 1.5; updateUI(); } else { showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –æ—á–æ–∫!"); } });
            buyRocketBtn.addEventListener('click', () => { if (gameState.rocketActive) { showNotification("–†–∞–∫–µ—Ç–∞ –≤–∂–µ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞!"); return; } const c = Math.round(gameState.costs.rocket); if (gameState.score >= c) { gameState.score -= c; gameState.rocketActive = true; gameState.stats.rocketsUsed++; buyRocketBtn.classList.add('rocket-active'); buyRocketBtn.disabled = true; setTimeout(() => { gameState.rocketActive = false; buyRocketBtn.classList.remove('rocket-active'); buyRocketBtn.disabled = false; showNotification("–î—ñ—è —Ä–∞–∫–µ—Ç–∏ –∑–∞–∫—ñ–Ω—á–∏–ª–∞—Å—å"); }, gameState.rocketDuration * 1000); gameState.rocketDuration += 0.2; gameState.levels.rocket++; gameState.costs.rocket *= 1.5; showNotification("–†–∞–∫–µ—Ç–∞ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞!", "bonus"); updateUI(); } else { showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –æ—á–æ–∫!"); } });
            buyEnergyRefillBtn.addEventListener('click', () => { const cost = 280; if (gameState.score >= cost) { gameState.score -= cost; gameState.energy = gameState.maxEnergy; showNotification('–ï–Ω–µ—Ä–≥—ñ—é –ø–æ–Ω–æ–≤–ª–µ–Ω–æ!', 'bonus'); updateUI(); } else { showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –æ—á–æ–∫!"); } });

            // --- –¢–∞–ø –ë–æ—Ç ---
            function updateTapBotUI() {
                const cost = Math.round(gameState.costs.tapBot);
                buyTapBotBtn.textContent = gameState.tapBotLevel === 0 ? cost : `+ ${cost}`;
                tapBotLevelDisplay.innerHTML = `–†—ñ–≤–µ–Ω—å: ${gameState.tapBotLevel} (1 –∫–ª—ñ–∫ / ${gameState.tapBotSpeed.toFixed(2)}—Å)`;
                
                toggleTapBotCheckbox.checked = gameState.tapBotEnabled;
                toggleTapBotCheckbox.parentElement.style.display = gameState.tapBotLevel > 0 ? 'inline-block' : 'none';

                if (gameState.tapBotSpeed <= 0.7) {
                    buyTapBotBtn.disabled = true;
                }
            }

            function startTapBot() {
                if (tapBotInterval) clearInterval(tapBotInterval);
                if (gameState.tapBotLevel > 0) {
                    tapBotInterval = setInterval(() => {
                        if (gameState.tapBotEnabled) {
                            gameState.score += gameState.clickPower;
                            gameState.stats.totalCoinsEarned += gameState.clickPower;
                            updateUI();
                        }
                    }, gameState.tapBotSpeed * 1000);
                }
            }

            function calculateOfflineEarnings() {
                if (gameState.tapBotEnabled && gameState.lastOfflineTimestamp) {
                    const offlineSeconds = (Date.now() - gameState.lastOfflineTimestamp) / 1000;
                    if (offlineSeconds > 1) {
                        const offlineClicks = Math.floor(offlineSeconds / gameState.tapBotSpeed);
                        const offlineEarnings = offlineClicks * gameState.clickPower;
                        if (offlineEarnings > 0) {
                            gameState.score += offlineEarnings;
                            gameState.stats.totalCoinsEarned += offlineEarnings;
                            showNotification(`–¢–∞–ø –±–æ—Ç –∑–∞—Ä–æ–±–∏–≤ ${Math.round(offlineEarnings)} –º–æ–Ω–µ—Ç, –ø–æ–∫–∏ –≤–∏ –±—É–ª–∏ –æ—Ñ–ª–∞–π–Ω!`, 'bonus');
                        }
                    }
                }
            }

            toggleTapBotCheckbox.addEventListener('change', () => {
                gameState.tapBotEnabled = toggleTapBotCheckbox.checked;
                if (gameState.tapBotEnabled) {
                    startTapBot();
                } else {
                    if (tapBotInterval) clearInterval(tapBotInterval);
                }
                updateTapBotUI();
            });

            buyTapBotBtn.addEventListener('click', () => {
                const cost = Math.round(gameState.costs.tapBot);
                if (gameState.score >= cost) {
                    if (gameState.tapBotSpeed <= 0.7) {
                        showNotification("–î–æ—Å—è–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è!");
                        return;
                    }
                    gameState.score -= cost;
                    gameState.tapBotLevel++;
                    gameState.tapBotSpeed = Math.max(0.7, gameState.tapBotSpeed - 0.25);
                    gameState.costs.tapBot *= 1.5;
                    
                    if (!gameState.tapBotEnabled) {
                        gameState.tapBotEnabled = true;
                    }
                    startTapBot();
                    updateTapBotUI();
                } else {
                    showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –æ—á–æ–∫!");
                }
            });

            // --- –ü—Ä–æ–º–æ–∫–æ–¥–∏ ---
            const promoCodes = {
                'begizhmot': { type: 'spins', value: 2 },
                'pig_777': { type: 'coins', value: 10000 },
                'planka_9876': { type: 'clickPowerLevels', value: 5 },
                'kentarnya': { type: 'coins', value: 1000 },
                'chocolatka_112233': { type: 'maxTapBot' },
                'raccoon1221': { type: 'balance_bonus' },
                'gedeshka': { type: 'clickPowerLevels', value: 15 },
                'tiktok_mode': { type: 'spins', value: 8 }
            };

            submitPromoBtn.addEventListener('click', () => {
                const code = promoInput.value.trim().toLowerCase();
                if (!code) return;

                if (gameState.usedPromoCodes.includes(code)) {
                    showNotification("–¶–µ–π –ø—Ä–æ–º–æ–∫–æ–¥ –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ!");
                    return;
                }

                const promo = promoCodes[code];
                if (promo) {
                    switch (promo.type) {
                        case 'spins':
                            gameState.dailySpins += promo.value;
                            showNotification(`–í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ ${promo.value} —Å–ø—ñ–Ω–∏!`, 'bonus');
                            break;
                        case 'coins':
                            gameState.score += promo.value;
                            showNotification(`–í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ ${promo.value} –º–æ–Ω–µ—Ç!`, 'bonus');
                            break;
                        case 'clickPowerLevels':
                            for (let i = 0; i < promo.value; i++) {
                                gameState.clickPower++;
                                gameState.levels.clickPower++;
                            }
                            showNotification(`–°–∏–ª—É –∫–ª—ñ–∫—É –∑–±—ñ–ª—å—à–µ–Ω–æ –Ω–∞ ${promo.value} —Ä—ñ–≤–Ω—ñ–≤!`, 'bonus');
                            break;
                        case 'maxTapBot':
                            gameState.tapBotLevel = 10;
                            gameState.tapBotSpeed = 0.7;
                            if (!gameState.tapBotEnabled) gameState.tapBotEnabled = true;
                            startTapBot();
                            showNotification('–¢–∞–ø –ë–æ—Ç –ø—Ä–æ–∫–∞—á–∞–Ω–æ –¥–æ –º–∞–∫—Å–∏–º—É–º—É!', 'bonus');
                            break;
                        case 'balance_bonus':
                            const bonus = Math.floor(gameState.score / 3);
                            gameState.score += bonus;
                            showNotification(`–í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –±–æ–Ω—É—Å ${bonus} –º–æ–Ω–µ—Ç!`, 'bonus');
                            break;
                    }
                    gameState.usedPromoCodes.push(code);
                    promoInput.value = '';
                    updateUI();
                } else {
                    showNotification("–ù–µ–≤—ñ—Ä–Ω–∏–π –ø—Ä–æ–º–æ–∫–æ–¥!");
                }
            });

            // --- –ü–∞—Å—Ö–∞–ª–∫–∞ ---
            let easterEggTimer;
            const startEasterEggTimer = () => { if (gameState.easterEggTriggered) return; easterEggTimer = setTimeout(() => { gameState.score += 510; gameState.easterEggTriggered = true; gameState.stats.easterEggFound = 1; showNotification("–ó–Ω–∞–π–¥–µ–Ω–æ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –±–æ–Ω—É—Å! +510", "bonus"); updateUI(); }, 2340); };
            const cancelEasterEggTimer = () => clearTimeout(easterEggTimer);
            shopBtn.addEventListener('mousedown', startEasterEggTimer);
            shopBtn.addEventListener('touchstart', startEasterEggTimer, { passive: true });
            shopBtn.addEventListener('mouseup', cancelEasterEggTimer);
            shopBtn.addEventListener('mouseleave', cancelEasterEggTimer);
            shopBtn.addEventListener('touchend', cancelEasterEggTimer);
            
            // --- –Ü–Ω—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó ---
            function checkDailyReward() { const today = new Date().toDateString(); if (gameState.lastRewardDate !== today) { const base = 100, bonus = gameState.score * 0.1, mult = 1.0 + Math.random() * 0.5; dailyRewardAmount = Math.round((base + bonus) * mult); showDailyRewardModal(dailyRewardAmount); } }
            function showDailyRewardModal(amount) { rewardAmountSpan.textContent = amount; dailyRewardModal.classList.add('active'); }
            function hideDailyRewardModal() { dailyRewardModal.classList.remove('active'); }
            claimRewardBtn.addEventListener('click', () => { gameState.score += dailyRewardAmount; gameState.lastRewardDate = new Date().toDateString(); hideDailyRewardModal(); dailyRewardBtn.style.display = 'none'; showNotification(`–í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ ${dailyRewardAmount} –º–æ–Ω–µ—Ç!`, 'bonus'); updateUI(); });
            closeRewardModalBtn.addEventListener('click', () => { hideDailyRewardModal(); dailyRewardBtn.style.display = 'block'; });
            dailyRewardBtn.addEventListener('click', () => showDailyRewardModal(dailyRewardAmount));
            function createParticles() { for (let i = 0; i < 15; i++) { const p = document.createElement('div'); p.classList.add('particle'); const a = Math.random()*Math.PI*2, d = Math.random()*50+50, x = Math.cos(a)*d, y = Math.sin(a)*d; p.style.setProperty('--x', `${x}px`); p.style.setProperty('--y', `${y}px`); p.style.left = '50%'; p.style.top = '50%'; coinContainer.appendChild(p); setTimeout(() => p.remove(), 1000); } }
            function showClickValue(value, isCritical, event) { const d = document.createElement('div'); d.id = 'click-value-display'; d.textContent = `+${value}`; if (isCritical) d.classList.add('critical-hit-text'); const r = coinContainer.getBoundingClientRect(), x = event.clientX - r.left, y = event.clientY - r.top; d.style.left = `${x}px`; d.style.top = `${y}px`; coinContainer.appendChild(d); setTimeout(() => d.remove(), 1000); }
            coin.addEventListener('click', handleCoinClick);
            coin.addEventListener('touchstart', (e) => { e.preventDefault(); handleCoinClick(e.touches[0]); }, { passive: false });
            setInterval(() => {
                const energyToRegen = 1 * gameState.tempEnergyRegenBonus;
                if (gameState.energy < gameState.maxEnergy) { 
                    gameState.energy += energyToRegen; 
                    if (gameState.energy > gameState.maxEnergy) gameState.energy = gameState.maxEnergy; 
                    updateUI(); 
                } 
            }, 2000);
            setInterval(() => { gameState.stats.timePlayed++; saveGame(); }, 1000);

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
            loadGame();
        });
    </script>
</body>
</html>

